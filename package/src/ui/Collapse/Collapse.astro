---
import type { HTMLTag, Polymorphic } from 'astro/types';
import type { Color, CommonColor } from '../../type';
import {
  getBgAndContentColorClass,
  getBgAndContentColorClassForFocus,
} from '../../utils/bgAndContentColor';
import { getBorderColorClass } from '../../utils/borderColor';
import Checkbox from '../Checkbox/Checkbox.astro';
import RadioInput from '../RadioInput/RadioInput.astro';
import type { CollapseIcon } from './types';

/**
 * Props for the AccordionItem component. Allows specifying the HTML tag to render.
 */
type Props<Tag extends HTMLTag = 'div'> = Polymorphic<{
  /**
   * The HTML tag to render the AccordionItem with.
   * @default 'div'
   */
  as: Tag;
  /**
   * The type of icon to use for the accordion trigger. Options are 'arrow' or 'plus-minus'.
   * @default 'arrow'
   */
  triggerIcon?: CollapseIcon | undefined;

  /**
   * If true, the collapse gets opened with focus. When the element loses focus, it gets closed
   * @default 'checkbox'
   */
  mode?: 'focus' | 'checkbox' | 'radio';

  /**
   * The name attribute for the item's radio input. Used for grouping when only one accordion item should be open at a time. This must be provided, if `mode` is `radio`
   */
  name?: string;

  color?: CommonColor | undefined;

  focusColor?: CommonColor | undefined;

  borderColor?: Color | undefined;
}>;

const {
  as: Tag = 'div',
  triggerIcon = 'arrow',
  name,
  color,
  focusColor,
  mode = focusColor ? 'focus' : 'checkbox',
  borderColor,
  class: providedClass,
  ...restProps
}: Props = Astro.props;

let cssClass = 'collapse';

if (providedClass) {
  cssClass += ` ${providedClass}`;
}

if (!color) {
  cssClass += ` border ${getBorderColorClass(borderColor ?? 'base-300')}`;
} else {
  cssClass += ` ${getBgAndContentColorClass(color)}`;
}

if (focusColor) {
  cssClass += ` ${getBgAndContentColorClassForFocus(focusColor)}`;
}

if (triggerIcon) {
  if (triggerIcon === 'arrow') {
    cssClass += ' collapse-arrow';
  } else if (triggerIcon === 'plus-minus') {
    cssClass += ' collapse-plus';
  }
}
---

<Tag class={cssClass} tabindex="0" {...restProps}>
  {mode === 'checkbox' ? <Checkbox /> : null}
  {mode === 'radio' ? <RadioInput name={name} /> : null}
  <slot />
</Tag>
